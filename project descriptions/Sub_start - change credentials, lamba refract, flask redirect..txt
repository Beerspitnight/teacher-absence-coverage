All scripts:

import os
import gspread
from google.oauth2.service_account import Credentials

def get_gspread_client():
    """Initialize and return an authorized Google Sheets client."""
    try:
        service_account_file = os.getenv("GOOGLE_SERVICE_ACCOUNT_FILE", "credentials.json")
        creds = Credentials.from_service_account_file(service_account_file, scopes=["https://www.googleapis.com/auth/spreadsheets"])
        return gspread.authorize(creds)
    except Exception as e:
        print(f"‚ùå Error initializing Google Sheets client: {e}")
        raise

# Refactored functions for manual_load.py

def apply_full_day(master_row, new_row):
    new_row[1:11] = master_row[1:11]

def apply_half_day_am(master_row, new_row):
    new_row[1:7] = master_row[1:7]
    new_row[7:11] = ["NSN"] * 4

def apply_half_day_pm(master_row, new_row):
    new_row[1:6] = ["NSN"] * 5
    new_row[6:11] = master_row[6:11]

def apply_periods(master_row, new_row, periods):
    for i in range(1, 11):
        new_row[i] = master_row[i] if str(i) in periods else "NSN"

period_mapping = {
    "Full Day": apply_full_day,
    "Half Day AM": apply_half_day_am,
    "Half Day PM": apply_half_day_pm,
    "Period": apply_periods,
}


# Updating the Flask redirect in dashboard.py
@app.route("/manual", methods=["GET", "POST"])
def manual():
    if request.method == "POST":
        teacher_name = request.form.get("teacher_name")
        duration = request.form.get("duration")
        sub_name = request.form.get("sub_name", "")
        periods = request.form.getlist("periods")
        
        try:
            manual_load.add_manual_absence(teacher_name, duration, periods, sub_name)
            flash("Manual absence added successfully!", "success")
        except Exception as e:
            flash(f"Error adding manual absence: {e}", "danger")
        
        return redirect(url_for("home"))  # Redirect to dashboard instead of reloading manual
    
    teacher_names = get_teacher_names()
    return render_template("manual.html", teacher_names=teacher_names, period_options=PERIOD_OPTIONS)
